<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Testing - Hexcore</title> <link rel="shortcut icon" href="/hexcore/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/hexcore/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/hexcore/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/hexcore/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Testing | Hexcore</title> <meta name="generator" content="Jekyll v4.2.1" /> <meta property="og:title" content="Testing" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Hexcore is advanced framework based on NestJs to build hexagonal architecture designed apps" /> <meta property="og:description" content="Hexcore is advanced framework based on NestJs to build hexagonal architecture designed apps" /> <link rel="canonical" href="https://mararok.github.io/hexcore/documentation/testing/" /> <meta property="og:url" content="https://mararok.github.io/hexcore/documentation/testing/" /> <meta property="og:site_name" content="Hexcore" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Testing" /> <script type="application/ld+json"> {"@type":"WebPage","description":"Hexcore is advanced framework based on NestJs to build hexagonal architecture designed apps","url":"https://mararok.github.io/hexcore/documentation/testing/","headline":"Testing","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="https://mararok.github.io/hexcore/" class="site-title lh-tight"> Hexcore </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item active"><a href="https://mararok.github.io/hexcore/documentation/testing/" class="nav-list-link active">Testing</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Hexcore" aria-label="Search Hexcore" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <p>Hexcore has some extra stuff for writing tests and support only Jest now.</p> <h2 id="global-test-setup"> <a href="#global-test-setup" class="anchor-heading" aria-labelledby="global-test-setup"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Global test setup </h2> <p>Use in your jest setup config file.</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="dl">'</span><span class="s1">@hexcore/core/lib/Util/Test/global-test-setup</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div> <h2 id="mockgeneralbus"> <a href="#mockgeneralbus" class="anchor-heading" aria-labelledby="mockgeneralbus"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> MockGeneralBus </h2> <p>Class for simulate handling command, queries and events</p> <h3 id="example"> <a href="#example" class="anchor-heading" aria-labelledby="example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example </h3> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Command.User.Create</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="na">generalBus</span><span class="p">:</span> <span class="nx">MockGeneralBus</span><span class="p">;</span>
  <span class="kd">let</span> <span class="na">handler</span><span class="p">:</span> <span class="nx">UserCreateCommandHandler</span><span class="p">;</span>

  <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">generalBus</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MockGeneralBus</span><span class="p">();</span> <span class="c1">// instance</span>
    <span class="nx">handler</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserCreateCommandHandler</span><span class="p">(</span><span class="nx">generalBus</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">execute()</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">command</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserCreateCommand</span><span class="p">(</span><span class="dl">"</span><span class="s2">test_username</span><span class="dl">"</span><span class="p">);</span>

    <span class="c1">// simple expection define:</span>
    <span class="nx">generalBus</span><span class="p">.</span><span class="nx">expectHandleCommand</span><span class="p">(</span><span class="k">new</span> <span class="nx">SendEmailToCommand</span><span class="p">(</span><span class="dl">"</span><span class="s2">test_username</span><span class="dl">"</span><span class="p">));</span>

    <span class="c1">// more complex expection define:</span>
    <span class="nx">generalBus</span><span class="p">.</span><span class="nx">expectHandleEvent</span><span class="p">((</span><span class="na">event</span><span class="p">:</span> <span class="nx">IEvent</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">event</span> <span class="k">instanceof</span> <span class="nx">UserCreatedEvent</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">username</span> <span class="o">===</span> <span class="nx">username</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">handler</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">command</span><span class="p">);</span>

    <span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">).</span><span class="nx">toMatchObject</span><span class="p">(</span><span class="nx">success</span><span class="p">(</span><span class="kc">true</span><span class="p">));</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div> <h2 id="mocker"> <a href="#mocker" class="anchor-heading" aria-labelledby="mocker"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Mocker </h2> <p>Very simple helper stuff to create mocks based on Jest.Mock</p> <p>Example:</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// You can create mock from class or interface</span>
<span class="kd">let</span> <span class="nx">userRepository</span> <span class="o">=</span> <span class="nx">Mocker</span><span class="p">.</span><span class="k">of</span><span class="o">&lt;</span><span class="nx">UserRepository</span><span class="o">&gt;</span><span class="p">();</span>

<span class="c1">// setting method expection on mock</span>
<span class="nx">userRepository</span>
      <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="dl">'</span><span class="s1">save</span><span class="dl">'</span><span class="p">,</span> <span class="nx">expect</span><span class="p">.</span><span class="nx">objectContaining</span><span class="p">({</span> <span class="nx">email</span><span class="p">,</span> <span class="nx">username</span><span class="p">,</span> <span class="na">password</span><span class="p">:</span> <span class="nx">hashedPassword</span> <span class="p">}))</span>
      <span class="p">.</span><span class="nx">andReturn</span><span class="p">(</span><span class="nx">successAsync</span><span class="p">(</span><span class="kc">true</span><span class="p">));</span>

<span class="c1">// on test end call:</span>
<span class="nx">userRepository</span><span class="p">.</span><span class="nx">checkExpections</span><span class="p">();</span>
</code></pre></div></div> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Command.User.Create</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="na">userRepository</span><span class="p">:</span> <span class="nx">Mocker</span><span class="o">&lt;</span><span class="nx">UserRepository</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="kd">let</span> <span class="na">generalBus</span><span class="p">:</span> <span class="nx">MockGeneralBus</span><span class="p">;</span>
  <span class="kd">let</span> <span class="na">handler</span><span class="p">:</span> <span class="nx">UserCreateCommandHandler</span><span class="p">;</span>

  <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">userRepository</span> <span class="o">=</span> <span class="nx">Mocker</span><span class="p">.</span><span class="k">of</span><span class="o">&lt;</span><span class="nx">UserRepository</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="nx">generalBus</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MockGeneralBus</span><span class="p">();</span>
    <span class="nx">handler</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserCreateCommandHandler</span><span class="p">(</span><span class="nx">userRepository</span><span class="p">.</span><span class="nx">i</span><span class="p">,</span> <span class="nx">generalBus</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">execute()</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">email</span> <span class="o">=</span> <span class="nx">Email</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="dl">'</span><span class="s1">test@makeupfield.com</span><span class="dl">'</span><span class="p">).</span><span class="nx">unwarp</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">Username</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">).</span><span class="nx">unwarp</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">password</span> <span class="o">=</span> <span class="nx">PlainPassword</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="dl">'</span><span class="s1">Test123!</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">command</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserCreateCommand</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">email</span><span class="p">,</span> <span class="nx">password</span><span class="p">);</span>

    <span class="kd">const</span> <span class="nx">hashedPassword</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">test_hash</span><span class="dl">'</span><span class="p">;</span>

    <span class="nx">passwordService</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="dl">'</span><span class="s1">hash</span><span class="dl">'</span><span class="p">,</span> <span class="nx">password</span><span class="p">).</span><span class="nx">andReturn</span><span class="p">(</span><span class="nx">successAsync</span><span class="p">(</span><span class="nx">hashedPassword</span><span class="p">));</span>
    <span class="nx">userRepository</span>
      <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="dl">'</span><span class="s1">save</span><span class="dl">'</span><span class="p">,</span> <span class="nx">expect</span><span class="p">.</span><span class="nx">objectContaining</span><span class="p">({</span> <span class="nx">email</span><span class="p">,</span> <span class="nx">username</span><span class="p">,</span> <span class="na">password</span><span class="p">:</span> <span class="nx">hashedPassword</span> <span class="p">}))</span>
      <span class="p">.</span><span class="nx">andReturn</span><span class="p">(</span><span class="nx">successAsync</span><span class="p">(</span><span class="kc">true</span><span class="p">));</span>
    <span class="nx">generalBus</span><span class="p">.</span><span class="nx">expectHandleEvent</span><span class="p">((</span><span class="na">event</span><span class="p">:</span> <span class="nx">IEvent</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">event</span> <span class="k">instanceof</span> <span class="nx">UserCreatedEvent</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">email</span> <span class="o">===</span> <span class="nx">email</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">username</span> <span class="o">===</span> <span class="nx">username</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">handler</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">command</span><span class="p">);</span>

    <span class="nx">passwordService</span><span class="p">.</span><span class="nx">checkExpections</span><span class="p">();</span>
    <span class="nx">userRepository</span><span class="p">.</span><span class="nx">checkExpections</span><span class="p">();</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">).</span><span class="nx">toMatchObject</span><span class="p">(</span><span class="nx">success</span><span class="p">(</span><span class="kc">true</span><span class="p">));</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div> <hr> <footer> <p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2021 Mararok</p> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
